function toggleActiveClass() {
  const element = document.getElementById('myElement');
  const isActive = element.classList.toggle('active');
  if (isActive) {
    element.innerHTML="<a href=\"midi-metro.html\" target=\"myFrame\">ﾒﾄﾛﾉｰﾑ閉じる</a>";
  }else{
    element.innerHTML="<a href=\"midi-metro-1.html\" target=\"myFrame\"><font size=-1>メトロノーム</font></a>";
  }
}
function soundOn(){
  const element1 = document.getElementById('mute');
  element1.innerHTML="";

// ＃＃＃＃＃＃＃＃＃＃
  navigator.requestMIDIAccess({sysex:false}).then(onMIDISuccess, onMIDIFailure);
  function onMIDISuccess(midiAccess) {
  	midi = midiAccess;		// store in the global (in real usage, would probably keep in an object instance)
//  	flag=1;

  	if (typeof midi.inputs === "function") {
  		inputs=midi.inputs();
  		outputs=midi.outputs();
  	} else {
  		var inputIterator = midi.inputs.values();
  		inputs = [];
  		for (var o = inputIterator.next(); !o.done; o = inputIterator.next()) {
  			inputs.push(o.value)
  		}
  		var outputIterator = midi.outputs.values();
  		outputs = [];
  		for (var o = outputIterator.next(); !o.done; o = outputIterator.next()) {
  			outputs.push(o.value)
  		}
  	}
  	if(input_menu_id!=null) setInputDeviceSelect();
  	if(output_menu_id!=null) setOutputDeviceSelect();
  }

  function onMIDIFailure(msg) {
  	log.innerHTML  = "Web MIDI API faile!";
  	log.innerHTML +="<br>";
  }

  function setInputDeviceSelect(){
  	var i=0;
  	if(midi!=null){
  		//--- 使用可能なデバイスの名前をメニューに設定する ---
  		if(inputs.length>0){
  			for(i=0; i<inputs.length; i++)
  				input_menu_id.options[i+1] = new Option(inputs[i].name, i+1)
  	  		input_menu_id.value=1;
  	  		input_device=0;
    			input=inputs[input_device];
    	  		input.onmidimessage = handleMIDIMessage0;
  		} else {
  			no_midi_interface=1;
  		}
  	}
  }
}

// ＃＃＃＃＃＃＃＃＃＃＃＃＃
// ＃＃＃＃＃＃＃＃＃＃＃＃＃

var log	=null;
var vlm=3;

var midi = null;			// global MIDIAccess object
var input=null; var outputs=null; var flag=0; var input_device=0; var output_device=0; var output_menu_id=null;
var j=0; var sh=0;
var grn={0:"#004A00",1:"#004E00",2:"#005200",3:"#005600",4:"#005A00",5:"#005F00",6:"#006300",7:"#006700",8:"#006B00",9:"#006F00",10:"#007400",11:"#007800",12:"#007C00",13:"#008000",14:"#008400",15:"#008900",16:"#008D00",17:"#009100",18:"#009500",19:"#009900",20:"#009E00",21:"#00A200",22:"#00A600",23:"#00AA00",24:"#00AF00",25:"#00B300",26:"#00B700",27:"#00BB00",28:"#00BF00",29:"#00C400",30:"#00C800",31:"#00CC00",32:"#00D000",33:"#00D400",34:"#00D900",35:"#00DD00",36:"#00E100",37:"#00E500",38:"#00E900",39:"#00EE00",40:"#00F200",41:"#00F600",42:"#00FA00",43:"#00FF00",44:"#00ff00",45:"#05ff05",46:"#0bff0b",47:"#10ff10",48:"#16ff16",49:"#1Bff1B",50:"#21ff21",51:"#27ff27",52:"#2Cff2C",53:"#32ff32",54:"#37ff37",55:"#3Dff3D",56:"#42ff42",57:"#48ff48",58:"#4Eff4E",59:"#53ff53",60:"#59ff59",61:"#5Eff5E",62:"#64ff64",63:"#6Aff6A",64:"#6Fff6F",65:"#75ff75",66:"#7Aff7A",67:"#80ff80",68:"#85ff85",69:"#8Bff8B",70:"#91ff91",71:"#96ff96",72:"#9Cff9C",73:"#A1ffA1",74:"#A7ffA7",75:"#ADffAD",76:"#B2ffB2",77:"#B8ffB8",78:"#BDffBD",79:"#C3ffC3",80:"#C8ffC8",81:"#CEffCE",82:"#D4ffD4",83:"#D6ffD6",84:"#D8ffD8",85:"#DAffDA",86:"#DCffDC",87:"#DEffDE"};
var bw={0:"#fff",1:"#000",2:"#fff",3:"#fff",4:"#000",5:"#fff",6:"#000",7:"#fff",8:"#fff",9:"#000",10:"#fff",11:"#000",12:"#fff",13:"#000",14:"#fff",15:"#fff",16:"#000",17:"#fff",18:"#000",19:"#fff",20:"#fff",21:"#000",22:"#fff",23:"#000",24:"#fff",25:"#000",26:"#fff",27:"#fff",28:"#000",29:"#fff",30:"#000",31:"#fff",32:"#fff",33:"#000",34:"#fff",35:"#000",36:"#fff",37:"#000",38:"#fff",39:"#fff",40:"#000",41:"#fff",42:"#000",43:"#fff",44:"#fff",45:"#000",46:"#fff",47:"#000",48:"#fff",49:"#000",50:"#fff",51:"#fff",52:"#000",53:"#fff",54:"#000",55:"#fff",56:"#fff",57:"#000",58:"#fff",59:"#000",60:"#fff",61:"#000",62:"#fff",63:"#fff",64:"#000",65:"#fff",66:"#000",67:"#fff",68:"#fff",69:"#000",70:"#fff",71:"#000",72:"#fff",73:"#000",74:"#fff",75:"#fff",76:"#000",77:"#fff",78:"#000",79:"#fff",80:"#fff",81:"#000",82:"#fff",83:"#000",84:"#fff",85:"#000",86:"#fff",87:"#fff"};

a_l = new Array(88);
for (i=21;i<109;i++){
  path="../snd/0/" + i + ".mp3";
  j=i-21;
  a_l[j] = new Audio(path);
}
// ---------------------------------------------

function handleMIDIMessage0( event ) {
// alert("2");
	var str=null;
	var i,k;


	if( event.data[0] ==0xFE ) return;

 // key down
   if (event.data[0]==144){
		  var note=event.data[1];
			sh=note-21;
      document.getElementById(note).style.backgroundColor = grn[sh];
// alert("3");
      avlm=vlm*0.1;
			a_l[sh].volume=avlm;
			a_l[sh].currentTime = 0;
      a_l[sh].play();
	 }

 // key up
   if (event.data[0]==128){
		  note=event.data[1];
      sh=note-21;
		  document.getElementById(note).style.backgroundColor = bw[sh];
   }
}


//　＃＃＃＃＃＃＃＃＃＃＃＃＃
//　＃＃＃＃＃＃＃＃＃＃＃＃＃
var id=0;
var $classAll= function(c){ return document.getElementsByClassName(c); };

window.onload = function() {
var KeyList = $classAll('wk');
for (i=0,len=KeyList.length; i<len; i++) {
  KeyList[i].addEventListener("mousedown",function(){
    id = this.getAttribute("id");
    sh=id-21;
    document.getElementById(id).style.backgroundColor =grn[sh];
    var vlm = document.getElementById("vol_piano").value;
    avlm=vlm*0.1;
    a_l[sh].volume=avlm;
    a_l[sh].currentTime = 0;
    a_l[sh].play();
  },false);
};

for (i=0,len=KeyList.length; i<len; i++) {
  KeyList[i].addEventListener("mouseup",function(){
    var id = this.getAttribute("id");
    document.getElementById(id).style.backgroundColor = "#fff";
  },false);
};

for (i=0,len=KeyList.length; i<len; i++) {
  KeyList[i].addEventListener("mouseout",function(){
    var id = this.getAttribute("id");
    document.getElementById(id).style.backgroundColor = "#fff";
  },false);
};

var bKeyList = $classAll("bk");
for (i=0,len=bKeyList.length; i<len; i++) {
  bKeyList[i].addEventListener("mousedown",function(){
    var id = this.getAttribute("id");
    sh=id-21;
    document.getElementById(id).style.backgroundColor =grn[sh];
    var vlm = document.getElementById("vol_piano").value;
    avlm=vlm*0.1;
    a_l[sh].volume=avlm;
    a_l[sh].currentTime = 0;
    a_l[sh].play();
  },false);
};

for (i=0,len=bKeyList.length; i<len; i++) {
  bKeyList[i].addEventListener("mouseup",function(){
    var id = this.getAttribute("id");
    document.getElementById(id).style.backgroundColor = "#000";
  },false);
};

for (i=0,len=bKeyList.length; i<len; i++) {
  bKeyList[i].addEventListener("mouseout",function(){
    var id = this.getAttribute("id");
    document.getElementById(id).style.backgroundColor = "#000";
  },false);
};

};


// ３＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃
// ＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃
var keycode={"KeyA":44,"KeyZ":45,"KeyS":46,"KeyX":47,"KeyC":48,"KeyF":49,"KeyV":50,"KeyG":51,"KeyB":52,"KeyN":53,"KeyJ":54,"KeyM":55,"Digit1":56,"KeyK":56,"Comma":57,"KeyQ":57,"KeyL":58,"Digit2":58,"Period":59,"KeyW":59,"Slash":60,"KeyE":60,"Quote":61,"Digit4":61,"IntlRo":62,"KeyR":62,"Backslash":63,"Digit5":63,"KeyT":64,"KeyY":65,"Digit7":66,"KeyU":67,"Digit8":68,"KeyI":69,"Digit9":70,"KeyO":71,"KeyP":72,"Minus":73,"BracketLeft":74,"Equal":75,"BracketRight":76};

window.addEventListener('DOMContentLoaded', function(){

  var pool =[];
  window.addEventListener('keydown', function(e){
    code=event.code;
    event.preventDefault();
    var kid=keycode[code];
//    kid=kid + add;
    x=kid-21;
    if (pool[x] == undefined) {
      document.getElementById(kid).style.backgroundColor = grn[x];
      var vlm = document.getElementById("vol_piano").value;
      avlm=vlm*0.1;
      a_l[x].volume=avlm;
      a_l[x].currentTime = 0;
      a_l[x].play();


      pool[x]=1;
    }

  }, false);

  window.addEventListener('keyup', function(e){
    var kc = event.code;
    var kid=keycode[kc];
//    kid=kid+add;
    x=kid-21;
    document.getElementById(kid).style.backgroundColor = bw[x];
    pool[x]=null;
  }, false);
});
